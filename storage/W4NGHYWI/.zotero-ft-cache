Tracking dynamic brain networks using high temporal resolution MEG measures of functional connectivity
Prejaas Tewarie 1, Lucrezia Liuzzi1, George C. O’Neill1, Andrew Quinn2, Alessandra Griffa3, Mark W. Woolrich2, Cornelis J. Stam4, Arjan Hillebrand*4, Matthew J. Brookes*1
1 Sir Peter Mansfield Imaging Centre, School of Physics and Astronomy, University of Nottingham, Nottingham, United Kingdom 2 Oxford Centre for Human Brain Activity, Department of Psychiatry, University of Oxford, United Kingdom 3 Dutch Connectome Lab, Department of Complex Trait Genetics, Center for Neuroscience and Cognitive Research, Amsterdam Neuroscience, Vrije Universiteit Amsterdam, Amsterdam, The Netherlands 4 Amsterdam UMC, Vrije Universiteit Amsterdam, Department of Clinical Neurophysiology and MEG Center, Amsterdam Neuroscience, De Boelelaan 1117, Amsterdam, The Netherlands
* equal contribution
Page count: 26 Word count: 11837 (incl. references) Figures: 6
*Corresponding author Prejaas Tewarie, MD, PhD Sir Peter Mansfield Imaging Centre School of Physics and Astronomy University of Nottingham University Park Nottingham Email: prejaas.tewarie@nottingham.ac.uk

ABSTRACT Fluctuations in functional interactions between brain regions typically occur at the millisecond time scale. Conventional connectivity metrics are not adequately time-resolved to detect such fast fluctuations in functional connectivity. At the same time, attempts to use conventional metrics in a time-resolved manner usually come with the selection of sliding windows of fixed arbitrary length. In the current work, we evaluated the use of high temporal resolution metrics of functional connectivity in conjunction with non-negative tensor factorisation to detect fast fluctuations in connectivity and temporally evolving subnetworks. To this end, we used the phase difference derivative and wavelet coherence, and we also introduced a new metric, the instantaneous amplitude correlation. In order to deal with the inherently noisy nature of magnetoencephalography data and large datasets, we make use of recurrence plots and we used pair-wise orthogonalisation to avoid spurious estimates of functional connectivity due to signal leakage. Firstly, metrics were evaluated in the context of dynamically coupled neural mass models in the presence and absence of delays and also compared to conventional static metrics with fixed sliding windows. Simulations showed that these high temporal resolution metrics outperformed conventional static connectivity metrics. Secondly, the sensitivity of the metrics to fluctuations in connectivity was analysed in post-movement beta rebound magnetoencephalography data, which showed time locked sensorimotor subnetworks that modulated with the beta rebound. Finally, sensitivity of the metrics was evaluated in resting-state magnetoencephalography, showing similar spatial patterns across metrics, thereby indicating the robustness of the current analysis. The current methods can be applied in cognitive experiments that involve fast modulations in connectivity in relation to cognition. In addition, these methods could also be used as input to temporal graph analysis to further characterise the rapid fluctuation in brain network topology.
Keywords: dynamic functional connectivity, temporal networks, magnetoencephalography, instantaneous amplitude correlation, phase difference derivative
Abstract word count: 279

INTRODUCTION
Large-scale functional interactions in the brain are assumed to be reflected in statistical interdependencies between time-series of neuronal activity (Friston et al. 1996), which can be quantified by magnetoencephalography (MEG) and electroencephalography (EEG). These functional interactions (functional connectivity, FC) are characterized by non-trivial spatiotemporal patterns in MEG/EEG data, which have so far predominantly been treated in a ‘static connectivity’ sense, i.e. interactions are estimated over relatively large time windows, typically on the order of seconds for MEG/EEG and tens of seconds for functional Magnetic Resonance Imaging (fMRI) (Hutchison et al. 2013; O’Neill et al. 2017). However, recent studies have shown that the brain operates at several timescales, including at fast timescales, which is reflected in strong fluctuations of both neuronal activity and neuronal interactions (Baker et al. 2014; Vidaurre et al. 2016; O’Neill et al. 2017a; Vidaurre et al. 2017; de Pasquale et al. 2017; O’Neill et al. 2017b). There is evidence that neuronal interactions appear in so-called dynamic cell assemblies that form and dissolve over time (Breakspear et al. 2004; Varela et al. 2001). By collapsing neuronal interactions over time, potentially crucial information about how large cell assemblies (sub-networks) emerge and dissolve is missed. Furthermore, recent studies have demonstrated that taking into account the temporal domain of oscillations or neuronal interactions may give better insight into abnormal brain function in neurological diseases (Carbo et al. 2017; Kim et al. 2017; Watanabe and Rees 2017; Sitnikova et al. 2018; Stam et al. 2005). Therefore, there is a pressing need to take into account the dynamics of functional interactions to obtain a complete picture of brain function in the healthy brain, as well as in neurological disorders.
Analysis of the dynamics of functional interactions has especially been of interest in the field of fMRI (Hansen et al. 2015; Griffa et al. 2017; Preti et al. 2017). Here, sliding window or point process approaches are often used to quantify fluctuations in functional connectivity (Allen et al. 2014). However, the limited temporal resolution of fMRI means that only fluctuations in the order of seconds can be detected and that the duration of the data acquisition should be sufficiently long in order to detect any non-stationary process (Hindriks et al. 2016). The superior temporal resolution of MEG and EEG is an advantage over fMRI, particularly when studying temporal fluctuations of connectivity. Studies on dynamic connectivity with MEG have indeed shown that functional networks can emerge and dissolve on a millisecond time-scale (Brookes et al. 2018; Vidaurre et al. 2018), but also fluctuate in the order of seconds (O’Neill et al. 2017). Some earlier EEG studies pointed out that functional interactions may even be scale-free (Stam and De Bruin 2004; Van de Ville et al. 2010)
However, most of the metrics of functional connectivity currently used in MEG/EEG require relatively large numbers of samples (Colclough et al. 2016; Fraschini et al. 2016), i.e. a time-window of certain length is required. Estimates of dynamic FC can then only be obtained using a (fixed) sliding window approach, which means that dynamics on faster or slower time-scales may be missed and, practically, a window-length needs to be defined a-priori. Furthermore, recent work has shown that the time scales of network formation and dissolution is continuously fluctuating during a MEG recording (Baker et al. 2014; Vidaurre et al. 2016; Vidaurre et al. 2018; López et al. 2019), and thus a fixed sliding window approach may not be the best approach to capture the underlying temporal evolution of connectivity.
An alternative to fixed sliding window approaches in conjunction with conventional connectivity metrics is to employ metrics of functional connectivity that have a high temporal resolution. Here, we introduce a new metric, which is derived from the often used amplitude envelope correlation metric

(Brookes et al. 2011; Hipp et al. 2012). The assumption is that if two neuronal populations show periods with simultaneous increases in power, then these periods could serve as windows that promote connectivity. Recent work has demonstrated that there is a tendency for simultaneous increases in power to coincide with increases in phase-based connectivity between two regions (Tewarie et al. 2018; Vidaurre et al. 2018). This metric is referred to as instantaneous amplitude correlation (IAC) and is an addition to other metrics with high temporal resolution such as the phase difference derivative (Breakspear et al. 2004), wavelet coherence (Grinsted et al. 2004), and the synchronisation likelihood (Stam and Van Dijk 2002). All these metrics provide information on connectivity at a high temporal resolution. However, the use of metrics with high temporal resolution also typically comes with the disadvantage of low signal to noise ratio (SNR). This is naturally the result of using insufficient time points to base the estimate on. A recently introduced approach solves this by using a Hidden Markov Model with multivariate autoregressive observation model (HMM-MAR). This identifies a finite set of states, with each state having distinct spectral and cross-spectral properties, allowing for data to be pooled over repeated state visits (i.e. effectively using data driven time windows) and thereby providing a wealth of time-points for the MAR to be estimated for each state (Vidaurre et al. 2016, 2017; 2018).
An alternative way to mitigate the effects of having insufficient time points is to use recurrence plots, a well-known method in the analysis of nonlinear dynamics (Eckmann et al. 1987; Deco et al. 2017). A recurrence plot reveals the times at which the phase space trajectory of a dynamical system visits roughly the same area in phase space during its evolution (analogous to states in HMM-based approaches). This can be used in the context of neuronal oscillations to provide data driven windows during which the system is in the same states. These windows can then be fed into connectivity analysis to potentially reduce the effect of noise, i.e. data driven windows are used to temporally aggregate sample by sample connectivity data. The resulting connectivity tensors, containing the estimates of dynamic FC, can be used for temporal graph analysis (Holme and Saramäki 2012) and for the extraction of temporally evolving subnetworks (Khambhati et al. 2018).
In the current paper we analyse how well high temporal resolution metrics of functional connectivity, including our new metric IAC, can detect genuine modulations in functional connectivity. This is done both with, and without, the use of recurrence plots. The manuscript is divided into two parts. Given a lack of ground truth in empirical MEG data, we first make use of parameterised connected neural mass models to generate simulated dynamic functional connectivity data. We use this model to test how sensitive the different approaches are to detect modulations in functional connectivity for short and longer state durations. We evaluate these metrics also in comparison to conventional metrics using a fixed sliding window approach. We then analyse how this sensitivity is affected by various levels of signal-to-noise ratio of the simulated data. In part two, we illustrate how the use of high temporal resolution metrics of functional connectivity can be applied to detect fluctuations of connectivity during the well-known post-movement beta rebound, as previous studies have demonstrated that the beta rebound co-occurs with an increase in connectivity (Vidaurre et al. 2016; Tewarie et al. 2018). This is followed by an analysis of resting-state data where we assess the use of data driven windows based on recurrence plots, and the subsequent extraction of temporally evolving subnetworks using non-negative tensor factorisation.

THEORY High temporal resolution measures of functional connectivity We employed three different metrics of instantaneous functional connectivity: The phase difference derivative (Breakspear et al. 2004), the wavelet coherence (Grinsted et al. 2004) and the instantaneous amplitude correlation.

The phase difference derivative (PDD) is a measure that captures the stability of phase relationships between two time-series. We extracted the instantaneous phase of each signal as 𝜑𝑖(𝑡) = 𝑎𝑡𝑎𝑛⁡(ℑ [𝐴𝑖(𝑡)]⁄ℜ [𝐴𝑖(𝑡)]), where 𝐴𝑖(𝑡), the analytic signal, was obtained using the Hilbert transform. The unwrapped phases were used for subsequent analysis. For each pair of signals i and j, it is assumed that there is phase-locking, i.e. a functional interaction, when the phase difference remains approximately constant over time, and hence when the derivative of the phase difference is approximately zero, mathematically

|𝑑∆𝜑𝑖𝑗(𝑡)| ≈ 0,⁡

(1)

𝑑𝑡

where ∆𝜑𝑖𝑗 refers to the instantaneous phase difference between signals i and j, |X| refers to the absolute value of X. We can then define a representation of dynamic phase connectivity for each pair of time-series using the following expression

𝑝𝑑𝑑𝑖𝑗 (𝑡)

=

exp

(−

|𝑑∆𝜑𝑖𝑗(𝑡)|)⁡,
𝑑𝑡

(2)

where the use of the decaying exponential ensures that the outcome is bounded between one and

zero,

and

where

|𝑑∆𝜑𝑖𝑗(𝑡)|
𝑑𝑡

≈

0

corresponds to a pdd value of one, and a pdd value approaching zero

corresponds to no coupling. Note that we have used an exponential decay function rather than an

arbitrary threshold in our previous work (Tewarie et al. 2018)

The wavelet coherence (WC) can be considered as a localised correlation coefficient in time frequency space. Any mother wavelet can be used for this purpose. However, similar to the original paper (Grinsted et al. 2004), we use the Morlet wavelet. First, the wavelet transform of a time-series (𝑥𝑛, 𝑛 = 1, … , 𝑁) is computed with a uniform time step 𝛿𝑡 by a convolution with the scaled and normalised wavelet 𝜓0

𝑊𝑛𝑋(𝑠)

=

√𝛿𝑡
𝑠

∑𝑁𝑛′=1

𝑥𝑛′

𝜓0[(𝑛′

−

𝑛]

𝛿𝑠𝑡.

(3)

The temporal scale of the wavelet is characterized by the scale parameter, s. For our purpose, the
scales that matches the frequency bands of interests are used. The wavelet power is subsequently given by |𝑊𝑛𝑋(𝑠)|2, while the cross wavelet transform of the two time-series 𝑥𝑛 and 𝑦𝑛 can be computed as 𝑊𝑋𝑌 = 𝑊𝑋𝑊𝑌∗, where * refers to the complex conjugate. From here, the wavelet
coherence follows

𝑊𝐶𝑛𝑋𝑌(𝑠)

=

|S(𝑠−1𝑊𝑛𝑋𝑌(𝑠))|2 S(𝑠−1|𝑊𝑛𝑋(𝑠)|2)⋅S(𝑠−1|𝑊𝑛𝑌(𝑠)|2

,
)

(4)

where S is a scale smoothing operator (see Equation 9 and 10 in (Grinsted et al. 2004) and also (Torrence and Compo 1998)). The time dependent wavelet coherence is subsequently averaged across scales (within a frequency band of interest).

The instantaneous amplitude correlation (IAC) metric is based on one of the intrinsic modes of functional connectivity (Engel et al. 2013), i.e. amplitude envelope correlation. If two regions show high amplitudes simultaneously, this can drive up the correlation between the two amplitude envelopes. The Hadamard product between the two amplitude envelope time-series could thus be used as an instantaneous measure of functional connectivity:

𝐼𝐴𝐶𝑖𝑗(𝑡) = 𝐸̂𝑖(𝑡) ∘ 𝐸̂𝑗(𝑡),

(5)

where ∘ represents the Hadamard product. The hat symbol in Equation 5 indicates that the amplitude envelopes, Ei(t), have been normalized to Z-scores. Note that this metric is not sensitive to interactions that are due to negative correlations between the signals’ amplitude envelopes.

None of the above metrics are intrinsically insensitive to the effects of signal leakage (spatial blurring in source space reconstructions that leads to significant spurious correlations between regional timeseries). We therefore used pairwise orthogonalisation to reduce leakage effects (Brookes et al. 2016) after band-pass frequency filtering (delta (1-4Hz), theta (4-8Hz), alpha (8-13Hz), beta (13-30Hz), gamma (30-48Hz)).

Data driven windows based on recurrence plots of the amplitude envelopes To handle large datasets (i.e. handle computational limitations) and to mitigate the effect of noisy estimates of connectivity, or to temporally aggregate connectivity data, one can use recurrence plots to define data driven windows for dynamic connectivity estimation. The emergence and dissolution of states in dynamical systems can be characterized by these recurrence plots (Marwan et al. 2007; Eckmann et al. 1987). More specifically, recurrence plots reveal the times at which the phase space trajectory of a dynamical system visits roughly the same area in phase space during its evolution (analogous to states in HMM models (Vidaurre et al. 2016, 2017,2018)). These recurrences are usually identified by

𝑅𝑖𝑗 = Θ(𝛿 − ‖𝒛𝑖 − 𝒛𝑗‖),

(6)

where i and j refer to two time points, 𝒛𝑖 to the trajectory at time i, Θ to the Heaviside function and 𝛿 to an arbitrary threshold, which is required to quantify how close two points on a trajectory should be to be assigned to the same state. The recurrence at i and j tells how similar the trajectories are at these different times. The state trajectory 𝒛𝑖 can be reconstructed from a single nodal time-series x by making use of time delayed embedding (Marwan et al. 2007). An alternative is to reconstruct 𝒛𝑖 where every element correspond to a value of the regional time-series at time i. In case of M regional time-series, 𝒛𝑖 would have dimensions M x 1. In order to avoid the use of an arbitrary choice for the threshold 𝛿, we use Spearman correlation instead of the norm in equation 6, such that the recurrence
between i and j becomes 𝑅𝑖𝑗 = corr(𝒛𝑖, 𝒛𝑗). These adapted recurrence plots are then used to identify points in time where the system undergoes a transition to another state by computing the derivatives (gradients) of the recurrence matrix 𝑅 (Figure 1). Local maxima in this gradient matrix along the diagonal reveal transitions between subsequent states, which can be used as boundary points for data driven windows. Note that these states are periods of time with similar amplitude envelopes profiles across the brain, i.e. similarity in phase space trajectories, and do not necessarily indicate connectivity

states by itself. The only constraint is that the minimum distance between local maxima is at least one oscillation (and is therefore depended on the frequency band of interest). Here we opted for the amplitude envelopes across all time-series as state vectors since these modulate on a slower time scale than the phases and show more variability in the patterns of their recurrence plots than the phases (see Figure S1). Specifically, in our case we estimated connectivity with one of the three different metrics described above on a sample-by-sample basis and subsequently pooled connectivity within a single window by averaging the sample-by-sample connectivity within that data driven window. Note that for any of the metrics, the data driven windows that were used to aggregate the connectivity data were based on the recurrence plots of the amplitude envelopes. A schematic overview of this approach is given in Figure 1. Note that we do not use recurrence plots computed after estimation of dynamic functional connectivity data as in (Cabral et al. 2017), but rather use recurrence plots based on the amplitudes envelopes as input to inform dynamic connectivity estimation.
Figure 1 Data driven windows: Panel A shows an example set of time-series and their respective amplitude envelopes. The amplitude envelopes at a single point in time i form a vector 𝒙𝑖. Thus every element in this vector corresponds to an amplitude envelope value from one time-series (i.e. brain location). The correlation of 𝒙𝑖 with a vector from another point in time 𝒙𝑗 quantifies the similarity between amplitude envelopes across regions for two different time points. Repeating this for all possible combinations of i and j results in the recurrence matrix in panel B. Blocks around the diagonal can be observed in the recurrence matrix, which can be considered as periods in time with temporary stable amplitude envelopes (states). These states can be used as data driven windows for which FC can be averaged, in order to reduce the effect of noise. Also note the off-diagonal blocks with high values that repeat within a row (or column) in the recurrence matrix. These indicate stable states that re-occur over time.

METHODS
Datasets We used data from two different datasets. A trial based and a continuously recorded dataset were used as separate proof for the new methods. We used a self-paced motor dataset to test our metrics, since our previous work has demonstrated that the PDD was sensitive and robust to detect connectivity patterns related to unilateral self-paced button press responses and modulated on the same time scale as the post-movement beta rebound (Tewarie et al. 2018). In the current work, we were interested in the performance of other metrics in comparison to the previously observed PDD connectivity results, and whether these other methods could identify modulations of connectivity occurring at the same timescale. At the same time, connectivity metrics are widely applied to resting state data. Here we opted to use data from the human connectome project given its large number of included subjects, and since it was recorded from another centre and scanner.
1. Dataset one was acquired at the Sir Peter Mansfield Imaging Centre, University of Nottingham. 15 healthy volunteers (9 male, age 25 ± 4 years (mean and standard deviation)) took part in a self-paced motor task (O’Neill et al. 2015; O’Neill et al. 2017b; Tewarie et al. 2018). Participants were in supine position in the MEG system and were instructed to press a button with the index finger of their left hand, approximately once every 30 seconds but without counting during the periods between button presses. Data were recorded for 25 minutes giving an average of 34 button presses (trials). Button presses were recorded by a button response pad. Single trials were defined as 30s in length, 15 seconds before each button press and 15 seconds after.
2. Dataset two was obtained from the human connectome project (HCP) (Van Essen et al. 2013). Data from 89 subjects as part of the HCP MEG2 release (Larson-Prior et al., 2013) were used. Initially, 95 subjects were included in the release, but six resting-state recordings did not pass the quality control checks (which included tests for excessive SQUID jumps, sensible power spectra and correlations between sensors). All subjects were young (22–35 years of age) and healthy.
MEG data acquisition and pre-processing For dataset one, MEG data were acquired using the third order synthetic gradiometer configuration of a 275 channel CTF MEG system (MISL, Coquitlam, Canada), at a sampling rate of 600Hz and using a 150Hz low pass anti-aliasing filter. Three coils were attached to the participant’s head as fiducial markers at the nasion, left and right preauricular points. These coils were energised continuously throughout acquisition to allow localisation of the head relative to the geometry of the MEG sensor array. Before MEG acquisition, the surface of the participant’s head was digitised relative to the three coils, using a 3D digitiser (Polhemus Inc., Vermont). Subsequent surface matching of the digitised head shape to an equivalent head shape extracted from an anatomical magnetic resonance image (acquired using a 3T or 7T MRI scanner running an MPRAGE sequence with a resolution of 1mm3) allowed coregistration of brain anatomy to MEG sensor geometry. Following collection, MEG data were inspected for artefacts and trials containing excessive interference were removed. Trials in which the participant was found to have moved more than 7 mm from their starting position were also removed.
For dataset two, resting-state MEG recordings were collected on a whole-head Magnes 3600 scanner (4D Neuroimaging, San Diego, CA, USA). Resting-state measurements were taken in three consecutive

sessions for each subject with little or no break in between, for 6 min each. The data were provided already pre-processed, after passing through a pipeline that removed artefactual segments of time from the recordings, identified recording channels that were faulty, and regressed out artefacts that appeared as independent components in an ICA decomposition with clear artefactual temporal signatures (such as eye-blinks or cardiac interference). Sensor-space data were down-sampled from 509 Hz to 300 Hz to facilitate processing, with the application of a zero-phase anti-aliasing filter (see (Larson-Prior et al. 2013) for details of pre-processing steps).
MEG: Source Localisation For dataset one, an atlas-based beamforming approach was adopted to project MEG sensor level data into source-space (Hillebrand et al. 2012). The cortex was parcellated into 78 individual regions of interest according to the automated anatomical labelling (AAL) atlas (Tzourio-Mazoyer et al. 2002). This was done by registering each subject’s anatomical MRI to an MNI template using a linear transformation (Flirt v5.5 FSL (Smith et al. 2004)) and labelling all cortical voxels according to the 78 cortical ROIs (Gong et al. 2009). Subsequently, the inverse registration to anatomical subject space was performed. A scalar beamformer (Robinson 1999) was employed to generate a single signal representative of electrophysiological activity within each of these AAL regions. To achieve this, for each region the centroid voxel was determined and the beamformer estimated time-series of electrical activity was derived for every centroid voxel (Hillebrand et al. 2016). Covariance was computed within a 1–150 Hz frequency window and a time window spanning the whole experiment (excluding bad trials) (Brookes et al. 2008). Regularisation was applied to the data covariance matrix using the Tikhonov method with a regularisation parameter equal to 5% of the maximum eigenvalue of the unregularised covariance matrix. The forward model was based upon a dipole approximation (Sarvas 1987) and a multiple local sphere head model (Huang et al. 1999) fitted to the MRI scalp surface extracted from the co-registered MRI. Dipole orientation was determined using a non-linear search for optimum ‘signal to noise ratio’ (SNR) (Robinson 1999), where SNR here is defined in terms of the pseudo Z-statistic. We applied depth normalization by normalizing the weights by 𝐷 = √𝒍𝑇𝑮−2𝒍, where G is the covariance matrix of the sensor data and l the lead fields (Sekihara and Nagarajan 2008). This complete process resulted in 78 electrophysiological time-series, each representative of a separate AAL region. This approach was applied to each subject individually. For dataset two, the same atlas-based beamforming approach was used, with the only difference that for dataset two we used the pre-computed single-shell source models that were provided by the HCP (Nolte 2003) for the estimation of the lead fields. This dataset and the beamforming pipeline has also been described in (Tewarie et al. 2018a).
Parameterised neural mass model Given the lack of a ground truth in empirical data, we employed a coupled two nodes Jansen and Rit neural mass model to serve as ground truth. Each node consists of an excitatory population, an inhibitory population, and a pyramidal population whose activity mimics the MEG/EEG signal (Jansen and Rit 1995). We coupled the output of the pyramidal populations to each other, informed by a structural coupling parameter k. Simulations were fed with a Gaussian white-noise process and equations were solved using a stochastic Heun’s integration scheme with a time step of 1x10-4. Parameters were the same as used in (Grimbert and Faugeras 2006). A working point near the Hopf bifurcation may be more realistic for MEG simulations (Tewarie et al. 2018; Deco et al. 2017), but in this case, the noise can make the system switch, in an unpredictable way, from the linear regime to

the limit cycle regime or vice versa. Therefore, the working point for the simulations was chosen to be in the limit cycle regime, i.e. a working point well after the Hopf bifurcation. The rationale for such a working point is its predictable behaviour. See Figure 2E for the system’s bifurcation diagram, which was computed using the XPPAUT software (Ermentrout 2002). Subsequently, instead of using a fixed value for the coupling parameter k, we fed the simulations with a time-series of k, with the values for k alternating between 0 and 0.7 (i.e. reflecting uncoupled and coupled states, respectively). The nonzero coupling value was sufficiently large for phase locking to occur. The state lifetimes were drawn from a gamma distribution. State durations were subsequently obtained by tuning the scale and shape parameters for the gamma distribution. This resulted in a controllable system for dynamic functional connectivity (see Figure 2). Adding noise to the data in a realistic way was done as in (Lobier et al. 2014). SNR was defined as 𝑆𝑁𝑅 = 20log10𝑦𝑠/𝑦𝑛, where 𝑦𝑠 is the mean amplitude of the neural mass signal and 𝑦𝑛 the mean amplitude of the noise. Noise signals Sn(t) were obtained by a uniform phase randomisation of the original neural mass signal Sj(t). These noise signals were subsequently added to the original signal as 𝑆𝑗𝑛(𝑡) = 𝑆𝑗(𝑡) + 𝑐𝑆𝑛(𝑡), where 𝑐 = 10−𝑆𝑁𝑅/20. Simulations were performed in Matlab 2015a using in-house scripts.
Figure 2 Parameterised neural mass model: Panel A shows an example of a short section of a time-series for the two nodes. Panel B shows the fluctuations of the structural coupling k, which will serve as ground truth for the dynamic connectivity metrics. Panel C shows the phases for the two nodes, from which it can be seen that there is phase locking during the states of non-zero coupling and unlocking when the nodes are uncoupled. Panel D shows the power spectrum for one of the nodes, and panel E shows the bifurcation diagram for the two node system. Y1 corresponds to the amplitude of the first excitatory population and P to the external input to the populations, serving here as bifurcation parameter. The red and black line correspond to the linear regime or fixed points (red corresponds to a stable fixed point and black to an unstable fixed point),

whereas the green curve shows the limit cycle regime. The transition point beyond P =100 is the Hopf bifurcation. Simulations were performed for P=200 (i.e. well after the Hopf bifurcation).

Extracting time evolving subnetworks using non-negative tensor factorisation Similar to (Ponce-Alvarez et al. 2015) we extracted time evolving subnetworks with non-negative tensor factorisation. This method can be considered as a higher order principal component analysis and decomposes a third order tensor into a set of basis vectors (Bro 1997; Gauvin et al. 2014)

𝑇 = ∑𝐿𝑙=1 𝒂𝑙 × 𝒃𝑙 × 𝒄𝑙.

(6)

Here × corresponds to the outer product, and 𝒂𝑙, 𝒃𝑙 and 𝒄𝑙 correspond to basis vectors of component l and have dimensions N (network size) and t (number of time points). In other words, the outer product of 𝒂𝑙 and 𝒃𝑙 reflects the connectivity patterns characterised by the time-series 𝒄𝑙. The factorisation of tensor T is found by solving the optimisation problem 𝑚𝑖𝑛𝐴,𝐵,𝐶‖𝑇 − 𝑇𝐴′,𝐵,𝐶‖ , with the constraints of non-negativity of the first two basis vectors (𝒂𝒌, 𝒃𝒌), and orthogonality of the last vectors 𝒄𝒌 (where 𝑇𝐴′,𝐵,𝐶 is the approximation of TA,B,C). The N-way toolbox (version 1.8) in Matlab was used for this analysis (Andersson and Bro 2000). Note that the input to the non-negative tensor
factorisation can either be the sample by sample time-series of functional connectivity values
('connectivity tensor'), or temporally downsampled (aggregated) time-series of connectivity values
obtained from the data-driven windowing based on the recurrence plots ('temporally downsampled connectivity tensor'). Lastly, we selected the number of components, L, based on the goodness-of-fit (F(l)) reaching a plateau level (𝐹(𝑙) = 1 − ‖𝑇 − 𝑇𝐴′,𝐵,𝐶(𝑙)‖⁄‖𝑇‖). This was determined by finding the maximum of 𝐷𝐹(𝑙) = [𝐹(𝑙) − 𝐹(𝑙 − 1)]⁄𝐹 (𝑙 + 1) (Timmerman and Kiers 2000). Since non-negative tensor factorisation is non-deterministic, optimisation could be sensitive to local minima. Hence, we also analysed the stability of obtained components (see Figure S2).

Analysis steps The analyses were divided into three parts. We first performed simulations in which estimated connectivity fluctuations were analysed in the context of a ground truth. This was followed by application of the connectivity metrics to empirical data, both for task-based data and resting-state data. Code can be found on Github (https://github.com/Prejaas/High-temporal-resolution-MEGmeasures-of-functional-connectivity).
Part 1: Performance of dynamic FC metrics for simulated data with known ground truth and comparison to conventional metrics. Simulated data were generated by two coupled neural mass models with a time-series for structural coupling k. This time-series is a binary time-series that fluctuates between zero and a non-zero coupling value (e.g. k=0.7). In the first analysis we tuned the duration for which k is non-zero (state life times) by changing the scale parameter of the gamma distribution such that the sensitivity of the high temporal resolution FC metrics for different state durations could be analysed. This was done in the absence and presence of conduction delays (10ms) in the coupling between the neural masses. We also evaluated and compared the high temporal resolution metrics to conventional phase- and amplitude based connectivity metrics during this analysis, i.e. the amplitude envelope correlation (AEC) (Brookes et al. 2011; Hipp et al. 2012), the phase locking value (PLV) (Lachaux et al. 1999), the phase lag index (PLI) (Stam et al. 2007), and the coherence (COH) (Nunez et al. 1997). We used a fixed sliding window approach where the size of the window width equalled the mean state duration for that particular iteration and with windows overlapping 50% in time. Since there was a dimension mismatch between the underlying ground truth connectivity timecourses and data from the conventional metrics (pooling data within a window to

one value), we interpolated the conventional connectivity estimates using a cubic spline interpolation. Since Implementation of the metrics was identical to (Liuzzi et al. 2017). As a second step, we analysed how well the metrics could detect genuine fluctuations in functional connectivity with an increase of the noise level (i.e. lowering the signal-to-noise ratio (SNR)). Spearman correlation between the ground truth (time-series of k) and the estimated functional connectivity modulations was used as outcome measure.
Part 2: Performance of dynamic FC metrics during post-movement beta rebound. We evaluated the high temporal resolution connectivity metrics during the post-movement beta rebound. We expected to see beta rebound related connectivity modulations for the different metrics, which has already been demonstrated for the phase difference in (Tewarie et al. 2018). Connectivity timecourses for the right sensorimotor cortex in the beta band were reconstructed (i.e. spatial average of connectivity between the right sensorimotor cortex and all other cortical regions). In addition, we also extracted subnetworks based on non-negative tensor factorisation. This was performed without the use of recurrence plots, since there was no need to temporally pool the data into data driven windows since a priori trials were defined as the time from 15 seconds before each button press to 15 seconds after the button press.
Part 3: Performance of dynamic FC metrics in resting-state data. To evaluate the high temporal resolution metrics of connectivity in conjunction with recurrence plots and non-negative tensor factorisation in resting-state MEG data we followed a two-step approach. Firstly, we estimated sample by sample connectivity by the different connectivity metrics to obtain connectivity tensors. This was followed by a non-negative tensor factorisation to extract temporal subnetworks from the full connectivity tensors (without the use of recurrence plots). It is important to point out that this analysis could not be conducted on the whole datasets for practical/computational reasons. We were only able to use 5% of the data using this analysis (i.e. 5% of total seconds of clean data of all subjects), due to working memory capacity on our linux machines. Note that the full connectivity tensor would be of size no.regions x no.regions x (sample frequency x total seconds clean data x subjects). Secondly, we estimated sample by sample connectivity using the different metrics and then used data driven windows obtained from recurrence plots of the amplitude envelopes to temporally aggregate the connectivity data (same procedure for all FC metrics). Since this led to a large reduction in the dimensions of the connectivity tensor (i.e. the temporal dimension reduces from “total seconds of clean data” to “number of states”) all of the data could be used. Subsequently, the temporally aggregated connectivity tensor was fed into non-negative tensor factorisation, resulting in spatial patterns of connected subnetworks and the temporal fluctuations of these subnetworks. The similarity between the subnetworks as obtained with the different connectivity metrics was quantified using Spearman correlation.
Lastly, we also evaluated whether the extracted spatial patterns of dynamic subnetworks could be obtained by functional connectivity timecourses based on surrogate data with the same covariance matrix. In other words, we tested the null hypothesis that spatial patterns of dynamic subnetworks could be extracted from noisy estimates of static networks. We constructed surrogate datasets using a uniform phase randomization procedure (Prichard and Theiler, 1994) in which the phase of the 78 regional timecourses were randomized using the same sequence of random numbers for every region (hence, maintaining the same covariance structure as for the original data, i.e., preserving static connectivity). Data analysis for the surrogate data was performed in the same way as for the genuine data. We subsequently estimated the number of components L from surrogate data by estimating the plateau of F(l) (see previous section) and created a null-distribution L with 1000 surrogates. The number of components from L the empirical data was tested against the null-distribution. In this way

we test the null-hypothesis that the surrogate data with same static connectivity contains similar spatiotemporal richness of the data as the empirical data.

RESULTS Part 1: Performance of dynamic FC metrics for simulated data with known ground truth and comparison to conventional metrics First, we tuned the scale parameter of the gamma distribution to obtain different mean state durations for the coupling time-series k (see Figure 2B). For every scale parameter we simulated 30 iterations of neural mass signals, and for each iteration, we simulated a different time-series for k. All sample by sample connectivity time-series were estimated from these coupled neural mass timeseries. Connectivity time-series for all three metrics were correlated with the ground truth of k using the Spearman correlation coefficient (R). This was also done for conventional phase- and amplitude based conventional metrics. In the absence of delays and for all metrics, we see a monotonically increasing R-curve that almost saturates for relatively longer state durations (Figure 3A). The IAC and WC perform slightly better than PDD in terms of capturing the underlying time-series of k (ground truth), resulting in higher Spearman correlations with the ground truth. All the three high temporal resolution clearly outperformed the conventional metrics in terms of identifying the underlying ground truth. The low correlation of the ground truth for PLI in the case of no delay is naturally the result of zero lag connectivity. The same analysis was repeated in the presence of conduction delays (Figure 3B). Simulations show again a monotonically increasing curve of R with increasing mean state durations, with an improvement for especially the PDD. Again the high temporal resolution metrics outperform the conventional connectivity metrics. The correlation of the PLI with the ground truth is now unequal to zero, given the appearance of non-zero lag connectivity in the case of no delays.
Figure 3 connectivity estimates versus ground truth in the absence and presence of delays: Panel A shows in the absence of delays, for each metric, the Spearman correlation between the ground truth modulation of coupling k and the estimated

functional connectivity time-series for different mean state durations. Panel B shows the same for simulations where conduction delays were included. Panel C and D shows the performance of the metrics for different levels of SNR (dB), with a fixed mean state duration of 500 ms. IAC = instantaneous amplitude correlation, PDD = phase difference derivative, WC = wavelet coherence, AEC = amplitude envelope correlation, PLV = phase locking value, PLI = phase lag index, COH = coherence. Note the saturation of the curves at shorter mean state durations in both conditions (panel A and B) and at lower SNR (panel C and D) for IAC and WC compared to PDD. Shaded areas correspond to the standard deviation of the data.
We subsequently assessed the ability of the high temporal resolution metrics to detect genuine fluctuations in connectivity for different SNRs of the data generated by the coupled neural masses. Figure 3C and D show the Spearman correlation between the ground truth modulation of coupling k and the estimated functional connectivity time-series as a function of SNR. Simulations were performed for a mean state duration of 500ms. The correlations seem to reach a plateau at an SNR of around 10 dB for the IAC and WC. For the PDD this plateau is reached for an SNR above 15 dB. Furthermore, the use of delays did not affect the results much.
Part 2: Performance of dynamic FC metrics during post-movement beta rebound We used a self-paced motor task to probe the sensitivity of the different connectivity metrics to capture post-movement related changes in beta band connectivity. Figure 4A shows the z-scores of connectivity time-series for the sensorimotor cortex in the beta band (i.e. average connectivity between the right sensorimotor cortex and all other regions, and averaged across subjects). It can be seen that both the PDD and IAC show time locked modulations in connectivity related to the unilateral self-paced button press responses (time zero corresponds to the button press). There is an increase in connectivity during the post-movement beta rebound (or event related synchronisation). This is less apparent for the wavelet coherence. The IAC shows in addition a decrease in connectivity during the beta desynchronization period (just before the button press). The IAC closely follows the power modulation in the sensorimotor cortex in the beta band that has been shown in previous works (see Figure 2 in (Tewarie et al. 2018b)).
We applied the non-negative tensor factorisation to the connectivity tensors (i.e. not restricting the analysis to the sensorimotor cortex). Results for the IAC show a spatial component that resembles the sensorimotor network (IAC component 2; Figure 4B, D), which showed time-locked modulations related to the self-paced button presses (Figure 4C) with a decrease in connectivity during the event related desynchronisation and increased connectivity during the post-movement beta rebound. The second component connects left and right parieto-temporal regions (Figure 4B, D) and shows the opposite temporal modulation (Figure 4C) with a decrease in connectivity during the post-movement beta rebound. The WC does not show any spatial component that modulates with the beta rebound, nor does it reveal any clear sensorimotor component or subnetwork. In contrast, WC shows components that are spatially similar to components extracted from resting-state data (see Figures 57). Lastly, the first component for the PDD shows spatial signatures of a sensorimotor network, which modulates with the beta rebound. Another PDD component with left centralised sensorimotor connections (component 2), does not show clear modulations during the beta rebound period.

Figure 4 Post-movement beta rebound related changes in connectivity: Panel A shows the group averaged time-frequency spectrogram of the self-paced motor task. Panel B shows connectivity time-series during the beta rebound for the sensorimotor cortex. Time-series correspond to averaged pairwise connectivity between all regions and the sensorimotor cortex, also averaged across subjects. Panel D shows brain plots of spatial components (𝒂𝑘 × 𝒃𝑘 obtained from the nonnegative tensor factorization of the connectivity tensors (from the full timecourse data rather than from recurrence plot driven windows). Panel C shows their related timecourses (𝒄𝑘)⁡and panel E shows the spatial components as matrix representation (𝒂𝑘 × 𝒃𝑘). IAC = instantaneous amplitude correlation, PDD = phase difference derivative, WC = wavelet coherence, comp = component.
Part 3: Performance of dynamic FC metrics in resting-state data We first used the high temporal resolution connectivity metrics to obtain high resolution connectivity tensors, i.e. tensors that were not temporally downsampled (no pooling of data) using recurrence plot driven windows. Note that only a fraction of the total data could be used due to computational limitations (see methods section: Analysis steps). Results for the alpha band for IAC (Figure 5A) show a predominantly frontal network (IAC first component), a predominantly occipital network (IAC second component), a left and right dominant network (IAC third and fourth component), a subnetwork in the midline (IAC fifth component) and a sensorimotor network (IAC sixth component). Since the connectivity matrices are symmetric for any given time point, the matrix (𝒂𝑘 × 𝒃𝑘) is symmetric. The outcome of the non-negative tensor factorisation also revealed that connectivity modulations in the alpha band for all these six components modulate between 0-6Hz with a similar spectral profile (Figure 5B). Results for WC show to some extent similar components (Figure 5C), such as left and right dominant networks, an occipital network, a frontal network and a sensorimotor network (albeit

localised more to the contralateral side), but also some other less clear-cut components, such as WC component 1. The similarity between the spatial pattern (𝒂𝑘 × 𝒃𝑘) of the components IAC and WC are depicted in the first row of Figure 5G, which shows the maximum correlation of IAC component n with any of the other component of WC. Maximum correlation refers to the observation that IAC component 4 has its equivalence with WC component 6 and not with, for example, WC component 4. Thus, the maximum correlation between IAC component 4 and the WC components is obtained for WC component 6. Results for the PDD shows the same picture, some components are spatially very similar to the IAC and WC based components, whereas others are different (e.g. IAC component 5 compared to all other WC components). The fluctuations for the temporal parts of the PDD obtained components are comparable to the fluctuations for the IAC and WC obtained components (compare Figures 5B, D, and F).
Figure 5 Resting-state dynamic networks without making use of recurrence plots: Panel A, C and E show the spatial patterns (𝒂𝑘 × 𝒃𝑘) of the subnetworks in the alpha band. Panel B, D and F the power spectral density for the different components (subnetworks) time courses (𝒄𝑘). Temporal fluctuations for all the components and metrics range between 0 and 6Hz in the alpha band. Panel G shows the maximum correlation, R, between spatial components obtained with different metrics (e.g. row 1, column 1 shows the maximum correlation between IAC component 1 and the different WC components). Brain plots in panel A, C, and E show 5% of the strongest connections. IAC = instantaneous amplitude correlation, PDD = phase difference derivative, WC = wavelet coherence, comp. = component.

Since making use of only a fraction of the data is suboptimal, we also made use of recurrence plots to temporally aggregate the data by making use of data-driven windows (i.e. based on recurrence plots). Figure 6A, B and C show the spatial components of the subnetworks for the different metrics. Note that for all metrics similar networks were obtained as for the analysis without recurrence plots (Figures 5A, C, E). However, making use of the recurrence plots also resulted in some differences, such as the appearance of two frontal networks for IAC in the recurrence based analysis, compared to one frontal network for IAC in the previous analysis, and an alteration from two frontal networks for the PDD in the previous analysis to one frontal network in the recurrence based analysis. However, the comparison between the two analyses (with and without making use of recurrence plots) is also influenced by the fact that less data was used for the previous analysis. Figure 6D shows the distribution of the length of the data driven windows. The smallest window size was similar to the length of an alpha oscillation (8-13Hz) (this was used as constraint for determining block length for the recurrence plots). Although we did extract the temporal evolution of the subnetworks using nonnegative tensor factorisation, we did not compute the spectral power of these timecourses, since each sample in this timecourse corresponds to a segment of a certain (variable) duration in the original data. In addition, note that the maximum correlation between the spatial components obtained with the different metrics (Figure 6E) was higher than for the case were no recurrence plots were used (Figure 5G). We subsequently found that the number of components L from empirical data exceeded the number of components from surrogate data, L from the data was significant while testing against a null distribution (Figure S3; p = 0.009). Spatial components and the distribution of the length of data driven windows for the other frequency bands are shown in Figure S4. Results show that very similar spatial components can be extracted from the different frequency bands (also compared to the results obtained from the alpha band shown in Figure 6), with few components that were frequency specific.

Figure 6 Resting-state dynamic networks with making use of recurrence plots: Panel A, B and C show the spatial patterns of the networks in the alpha band. Panel D shows the distribution of the length of the data driven windows (or states) obtained by the recurrence plots. Panel E shows the maximal correlation between spatial components obtained with different metrics (e.g. row 1, column 1 shows the maximal correlation between the IAC first component and any of the WC components). Brain plots in panel A, B, and C show 5% of the strongest connections. IAC = instantaneous amplitude correlation, PDD = phase difference derivative, WC = wavelet coherence, comp. = component.

DISCUSSION
Understanding the formation and dissolution of temporal electrophysiological networks is believed to be crucial to understand ongoing cognitive function. However, capturing temporal fluctuations in functional connectivity adds another level of difficulty to connectivity analysis. Since it has been argued that neuronal oscillatory dynamics, as well as fluctuations in connectivity, can be characterised by scale-freeness (Stam et al., 2004; Linkenkaer-Hansen et al. 2001), there is a need to move beyond conventional fixed sliding window analyses. By using a fixed window an arbitrary scale is selected that is not necessary representative of the data. Here, we used one new (IAC) and two existing (WC and PDD) measures of functional connectivity with high temporal resolution in conjunction with nonnegative tensor factorisation to extract time evolving subnetworks. Recurrence plots allowed us to pool connectivity data within states and thus enhancing the SNR of connectivity and reducing computational costs. We first demonstrated using simulations with a given ground truth that these metrics are able to extract fluctuations of connectivity in the order of milliseconds and outperform conventional phase- and amplitude based static connectivity metrics using a fixed sliding window approach. The use of these metrics was further illustrated in a self-paced motor task and in restingstate MEG data. IAC and PDD revealed time evolving subnetworks that co-occurred with the beta rebound, and several resting-state subnetworks were found that were remarkably similar across the different metrics. Recurrence plots could be used without concern to distort the connectivity data as subnetworks obtained from recurrence based analysis were quite similar to obtained subnetworks without the use of recurrence plots.
The difficulty with evaluating connectivity metrics using empirical MEG data is the lack of a ground truth. We therefore turned to simulations with a ground truth using a parameterised coupled neural mass model. Our simulations showed that all metrics were better in capturing the ground truth of the underlying connectivity timecourse than conventional phase- and amplitude based static connectivity metrics, due to the fact that these metrics were not sufficiently time resolved. While keeping in mind that simulations in general never form a complete picture of empirical data, these results could inform us that for the range in which we tested these metrics (60-800ms), these metrics may be applied to experimental data for the extraction of temporally evolving connectivity, knowing that any observed dynamical functional connectivity is likely not merely the result of static connectivity superimposed by some noise. This includes the newly introduced metric, the IAC. However, performance declined for shorter state durations (shorter than 100-50ms; see Figures 2A,B) and therefore one should be more cautious when using these metrics for analysis in when experimental observed state durations are below this range (e.g. gamma band in resting-sate, see Figure S4G). Another issue that can be analysed with simulations is the sensitivity of these metrics to detect genuine fluctuations of connectivity in the presence of noise. The problem with empirical MEG data is that we are not able to directly infer the level of noise from the data. Noise in this context is a mixture of environmental, instrumentational and biological noise. While quantification of the two latter is not always trivial, one can easily determine environmental noise from empty room recordings. By only using the latter (Lobier et al. 2014) quantified the apparent SNR (ignoring the other components) and showed that the apparent SNR lies between 8-17dB, depending on the frequency. Since this might be an overestimation given the fact that the instrumentational and biological noise were ignored it might give an indication about the order of the SNR in empirical data. Simulations in our data showed that for SNR higher than 1 the metrics were capable of distinguishing genuine dynamic connectivity from noise-driven fluctuations. The purely phase based metric, PDD, was less robust for different levels of

SNR, maybe due to the relatively noisiness of phase data (such as the occurrence of phase jumps). This may also explain why the PDD was less sensitive to dynamic FC with shorter mean state durations compared to the other metrics.
We subsequently evaluated the measures of functional connectivity in a self-paced motor task, since we know from previous studies that the post-movement beta rebound co-occurs with a rapid rise in connectivity (Vidaurre et al. 2016; Tewarie et al. 2018; Quinn et al. 2018). The use of PDD in conjunction with statistical testing using surrogate data was previously evaluated in the motor task (Tewarie et al. 2018), however, the other two metrics had not yet been evaluated in this context. In addition to the PDD, only the IAC was able to track a rise in connectivity during the beta rebound. One could however argue that a rise in IAC is trivial during this task given that it is completely driven by the beta rebound. However, extraction of subnetworks using non-negative tensor factorisation did show a clear sensorimotor network for the IAC that was modulating with a decrease in connectivity during event related synchronisation as well as increase in connectivity during the post-movement beta rebound (IAC component two in Figure 3C). The spatial components for IAC further showed features that may resemble motor fields (MFs) and motor evokked fields (MEFs) (Mayville et al. 2005; Suzuki et al. 2013). The WC was the only metric that was not able to extract meaninful task-related subnetworks and none of the subnetworks modulated with the beta rebound. However, WC did show subnetworks with spatial structure similar to resting-state obtained subnetworks. This could indicate that WC is less sensitive to fast fluctuations in connectivity, although this was not shown by the simulations. We expected that the wavelet coherence would be able to detect fluctuations in both phase- and amplitude-based coupling. The lower sensitivity of wavelet coherence to fast fluctuations could be related to the fact that, unlike the other metrics, the temporal resolution of WC is limited by the width of the mother wavelet.
Finally, we tracked temporally evolving subnetworks in resting-state data. Results for analysis without recurrence plots show spatial patterns of functional connectivity fluctuating on temporal time-scales that were restricted by the frequencies of the oscillatory activity. In contrast to task-based data, one of the important findings for resting-state data was that spatial patterns obtained from different metrics were fairly similar. The reason for this discrepancy between task based and resting-state dynamic connectivity is unclear, but this also known from static connectivity analysis. For example, (Colclough et al. 2016) showed that connectivity matrices across metrics can be fairly similar in the static connectivity sense for resting-state data, whereas for cognitive tasks the results for static connectivity can be quite different for amplitude- and phase-based metrics (Helfrich et al. 2016). Having said this, we extracted spatial patterns that were also quite similar to recently described (e.g. phase locking) subnetworks obtained using an HMM approach (Vidaurre et al. 2018), such as an occipital-, frontal- and sensorimotor network. In addition, we also found left and right dominant hemispheric networks.
The use of measures of functional connectivity with high temporal resolution also comes with the hurdle of low SNR, and the problem of computational limitations with big connectivity tensors. The latter could be tackled in the future by making use of advanced computer grids with ‘unlimited’ memory and CPU capacity, however this may not be feasible for most of the scientists working in the (clinical) field. We therefore opted to use recurrence plots to temporally downsample the functional connectivity data. Results showed subnetworks that were quite similar to the ones extracted without the use of recurrence plots. Therefore, recurrence plots could be used depending on the scientific

question and dataset of interest. When dealing with large groups and datasets, recurrence plots can be used to allow for computations on the whole dataset without loss of signficant information. It is also noteworthy that the duration of the states obtained from the recurrence plots match the frequencies at which the functional connectivity patterns modulate (estimated without the use of recurrence plots; compare Figure 6D with Figures 5B,D,F). These state durations were also very simlar to the duration of the HMM states as was found by (Baker et al. 2014). We did observe small differences between subnetworks obtained with and without the use of recurrence plots though, which may be explained by differences in SNR of connectivity (i.e. pooling over data) and making use of less data. By making use of recurrence plots of the amplitude envelope, we also limited ourselves to the relatively slow scales of the fluctuations of the amplitude envelope, and thereby also potentially limited ourselves to slower scales of dynamic functional connectivity. However, the current analysis is just an example of how the general idea of recurrence can be used to define states. Recurrence plot can also be based on other characteristics of the data (e.g. those with faster dynamics; see also Figures S1 for the recurrence plot of the phases).
Some other aspects of our methodology are worth mentioning. Firstly, for WC, we chose the Morlet wavelet as mother wavelet, as was done in the original work (Grinsted et al. 2004). Although beyond the scope of the current work, the use of other mother wavelets could also be considered or evaluated,. Secondly, we used non-negative tensor factorisation to extract temporally evolving subnetworks. Other methods could be used in this context as well, such as independent component analysis (O’Neill et al. 2017), K-means clustering (O’Neill et al. 2015) and dynamic modularity analysis (Bassett et al. 2013). However, given the recent literature on this topic and the stability of our results across runs we opted for non-negative tensor factorisation (Khambhati et al. 2018). Future work will need to elucidate to what extent these different methods are able to extract similar and/or complementary subnetworks, as the emphasis of the current work was on the estimation of the dynamic functional connectivity itself. Related to this point, results showed for some extracted components a mismatch between the spatial structure as obtained for the different metrics. Future work could show whether this mismatch was an effect related to the factorisation or due to a difference in performance of the FC metrics. Fourthly, reconstruction of data driven windows is based on an assumption that there are fast transitions between amplitude envelope states (also an assumption for HMM states). This can be observed from the recurrence plots (Figure 1 and Figure S1), where there is a formation and dissolution of blocks along the diagonal (i.e. blocks correspond to stationary amplitude envelops during a short period of time). However, the same recurrence plots also show that there can be periods during which there are no clear of blocks in the matrix, indicating a smooth evolution of the phase space trajectory. Therefore in brain data, transitions between states may be fast or slow. Future work will need to formulate a methodological framework that can capture both transitions in relation to connectivity data. An option is to use high temporal resolution metrics without the use of recurrence plots. Fifthly, we did not include the synchronisation likelihood metric in our analysis (Stam and Van Dijk 2002), since it is computational very intensive to compute this metric on large datasets. Lastly, our simulations were limited by two important factors. We only used two nodes in our simulations since we were interested in pairwise connectivity (not higher order coupling). The effect of a common source or secondary leakage cannot be evaluated in this way, however, multivariate methods exist to reduce secondary leakage (Colclough et al. 2015). In addition, we did not include a adaptive spatial filter into our analysis, since the goal of the current analysis was only to test the performance of the connectivity metric, while excluding other sources of error such as the error introduced by an adaptive spatial filter.

Using simulated and experimental data, we have demonstrated that it was feasible to use measures of functional connectivity that have high temporal resolution. These measures were sensitive to genuine fluctuations in functional connectivity and outperformed conventional phase- and amplitude based metrics using a fixed sliding window approach. Applying these metrics does not require a-priori defined window widths, leaving the analysis open to study fast fluctuations in connectivity during cognitive tasks, as well as during a resting-state. Especially the PDD and IAC seemed to be applicable in this context. Another domain of impact is the field of temporal graph analysis. Until now, temporal graph analysis in electrophysiology has been restricted by the use of fixed sliding windows, resulting in suboptimal input to the temporal graph analysis.
ACKNOWLEDGMENTS This work was funded by a Medical Research Council New Investigator Research Grant (MR/M006301/1) awarded to MJB. We also acknowledge Medical Research Council Partnership Grant (MR/K005464/1).
REFERENCES
Allen EA, Damaraju E, Plis SM, Erhardt EB, Eichele T, Calhoun VD. 2014. Tracking whole-brain connectivity dynamics in the resting state. Cereb cortex. 24:663–676.
Andersson CA, Bro R. 2000. The N-way toolbox for MATLAB. Chemom Intell Lab Syst. 52:1–4.
Baker AP, Brookes MJ, Rezek IA, Smith SM, Behrens T, Smith PJP, Woolrich M. 2014. Fast transient networks in spontaneous human brain activity. Elife. 3:e01867.
Bassett DS, Porter MA, Wymbs NF, Grafton ST, Carlson JM, Mucha PJ. 2013. Robust detection of dynamic community structure in networks. Chaos An Interdiscip J Nonlinear Sci. 23:13142.
Breakspear M, Williams LM, Stam CJ. 2004. A novel method for the topographic analysis of neural activity reveals formation and dissolution of “dynamic cell assemblies.” J Comput Neurosci. 16:49–68.
Bro R. 1997. PARAFAC. Tutorial and applications. Chemom Intell Lab Syst. 38:149–171.
Brookes MJ, Groom MJ, Liuzzi L, Hill RM, Smith HJF, Briley PM, Hall EL, Hunt BAE, Gascoyne LE, Taylor MJ. 2018. Altered temporal stability in dynamic neural networks underlies connectivity changes in neurodevelopment. Neuroimage. 174:563–575.
Brookes MJ, Hale JR, Zumer JM, Stevenson CM, Francis ST, Barnes GR, Owen JP, Morris PG, Nagarajan SS. 2011. Measuring functional connectivity using MEG: methodology and comparison with fcMRI. Neuroimage. 56:1082–1104.
Brookes MJ, Tewarie PK, Hunt BAE, Robson SE, Gascoyne LE, Liddle EB, Liddle PF, Morris PG. 2016. A multi-layer network approach to MEG connectivity analysis. Neuroimage. 132:425–438.
Brookes MJ, Vrba J, Robinson SE, Stevenson CM, Peters AM, Barnes GR, Hillebrand A, Morris PG. 2008. Optimising experimental design for MEG beamformer imaging. Neuroimage. 39:1788– 1802.
Cabral J, Luckhoo H, Woolrich M, Joensson M, Mohseni H, Baker A, Kringelbach ML, Deco G. 2014. Exploring mechanisms of spontaneous functional connectivity in MEG: how delayed network interactions lead to structured amplitude envelopes of band-pass filtered oscillations. Neuroimage. 90:423–435.

Cabral J, Vidaurre D, Marques P, Magalhães R, Moreira PS, Soares JM, Deco G, Sousa N, Kringelbach ML. 2017. Cognitive performance in healthy older adults relates to spontaneous switching between states of functional connectivity during rest. Sci Rep. 7:5135.
Carbo EWS, Hillebrand A, Van Dellen E, Tewarie P, de Witt Hamer PC, Baayen JC, Klein M, Geurts JJG, Reijneveld JC, Stam CJ. 2017. Dynamic hub load predicts cognitive decline after resective neurosurgery. Sci Rep. 7:42117.
Colclough GL, Brookes MJ, Smith SM, Woolrich MW. 2015. A symmetric multivariate leakage correction for MEG connectomes. Neuroimage. 117:439–448.
Colclough GL, Woolrich MW, Tewarie PK, Brookes MJ, Quinn AJ, Smith SM. 2016. How reliable are MEG resting-state connectivity metrics? Neuroimage. 138:284–293.
de Pasquale F, Corbetta M, Betti V, Della Penna S. 2017. Cortical cores in network dynamics. Neuroimage.
Deco G, Cabral J, Woolrich MW, Stevner ABA, Van Hartevelt TJ, Kringelbach ML. 2017. Single or multiple frequency generators in on-going brain activity: A mechanistic whole-brain model of empirical MEG data. Neuroimage. 152:538–550.
Deco G, Kringelbach ML, Jirsa VK, Ritter P. 2017. The dynamics of resting fluctuations in the brain: metastability and its dynamical cortical core. Sci Rep. 7:3095.
Eckmann J-P, Kamphorst SO, Ruelle D. 1987. Recurrence plots of dynamical systems. EPL (Europhysics Lett. 4:973.
Engel AK, Gerloff C, Hilgetag CC, Nolte G. 2013. Intrinsic coupling modes: multiscale interactions in ongoing brain activity. Neuron. 80:867–886.
Ermentrout B. 2002. Simulating, analyzing, and animating dynamical systems: a guide to XPPAUT for researchers and students. Siam.
Fraschini M, Demuru M, Crobe A, Marrosu F, Stam CJ, Hillebrand A. 2016. The effect of epoch length on estimated EEG functional connectivity and brain network organisation. J Neural Eng. 13:36015.
Friston KJ, Frith CD, Fletcher P, Liddle PF, Frackowiak RSJ. 1996. Functional topography: multidimensional scaling and functional connectivity in the brain. Cereb cortex. 6:156–164.
Gauvin L, Panisson A, Cattuto C. 2014. Detecting the community structure and activity patterns of temporal networks: a non-negative tensor factorization approach. PLoS One. 9:e86028.
Gong G, He Y, Concha L, Lebel C, Gross DW, Evans AC, Beaulieu C. 2009. Mapping anatomical connectivity patterns of human cerebral cortex using in vivo diffusion tensor imaging tractography. Cereb cortex. 19:524–536.
Griffa A, Ricaud B, Benzi K, Bresson X, Daducci A, Vandergheynst P, Thiran J-P, Hagmann P. 2017. Transient networks of spatio-temporal connectivity map communication pathways in brain functional systems. Neuroimage. 155:490–502.
Grimbert F, Faugeras O. 2006. Bifurcation analysis of Jansen’s neural mass model. Neural Comput. 18:3052–3068.
Grinsted A, Moore JC, Jevrejeva S. 2004. Application of the cross wavelet transform and wavelet coherence to geophysical time series. Nonlinear Process Geophys. 11:561–566.
Hansen ECA, Battaglia D, Spiegler A, Deco G, Jirsa VK. 2015. Functional connectivity dynamics:

modeling the switching behavior of the resting state. Neuroimage. 105:525–535.
Helfrich RF, Knepper H, Nolte G, Sengelmann M, König P, Schneider TR, Engel AK. 2016. Spectral fingerprints of large‐scale cortical dynamics during ambiguous motion perception. Hum Brain Mapp. 37:4099–4111.
Hillebrand A, Barnes GR, Bosboom JL, Berendse HW, Stam CJ. 2012. Frequency-dependent functional connectivity within resting-state networks: an atlas-based MEG beamformer solution. Neuroimage. 59:3909–3921.
Hillebrand A, Tewarie P, Van Dellen E, Yu M, Carbo EWS, Douw L, Gouw AA, Van Straaten ECW, Stam CJ. 2016. Direction of information flow in large-scale resting-state networks is frequencydependent. Proc Natl Acad Sci. 113:3867–3872.
Hindriks R, Adhikari MH, Murayama Y, Ganzetti M, Mantini D, Logothetis NK, Deco G. 2016. Can sliding-window correlations reveal dynamic functional connectivity in resting-state fMRI? Neuroimage. 127:242–256.
Hipp JF, Hawellek DJ, Corbetta M, Siegel M, Engel AK. 2012. Large-scale cortical correlation structure of spontaneous oscillatory activity. Nat Neurosci. 15:884–890.
Holme P, Saramäki J. 2012. Temporal networks. Phys Rep. 519:97–125.
Huang MX, Mosher JC, Leahy RM. 1999. A sensor-weighted overlapping-sphere head model and exhaustive head model comparison for MEG. Phys Med Biol. 44:423.
Hutchison RM, Womelsdorf T, Allen EA, Bandettini PA, Calhoun VD, Corbetta M, Della Penna S, Duyn JH, Glover GH, Gonzalez-Castillo J. 2013. Dynamic functional connectivity: promise, issues, and interpretations. Neuroimage. 80:360–378.
Jansen BH, Rit VG. 1995. Electroencephalogram and visual evoked potential generation in a mathematical model of coupled cortical columns. Biol Cybern. 73:357–366.
Khambhati AN, Mattar MG, Wymbs NF, Grafton ST, Bassett DS. 2018. Beyond modularity: Fine-scale mechanisms and rules for brain network reconfiguration. Neuroimage. 166:385–399.
Kim J, Criaud M, Cho SS, Díez-Cirarda M, Mihaescu A, Coakeley S, Ghadery C, Valli M, Jacobs MF, Houle S. 2017. Abnormal intrinsic brain functional network dynamics in Parkinson’s disease. Brain. 140:2955–2967.
Lachaux J-P, Rodriguez E, Martinerie J, Varela FJ. 1999. Measuring phase synchrony in brain signals. Hum Brain Mapp. 8:194–208.
Larson-Prior LJ, Oostenveld R, Della Penna S, Michalareas G, Prior F, Babajani-Feremi A, Schoffelen JM, Marzetti L, de Pasquale F, Di Pompeo F. 2013. Adding dynamics to the Human Connectome Project with MEG. Neuroimage. 80:190–201.
Linkenkaer-Hansen K, Nikouline V V, Palva JM, Ilmoniemi RJ. 2001. Long-range temporal correlations and scaling behavior in human brain oscillations. J Neurosci. 21:1370–1377.
Liuzzi L, Gascoyne LE, Tewarie PK, Barratt EL, Boto E, Brookes MJ. 2017. Optimising experimental design for MEG resting state functional connectivity measurement. Neuroimage. 155:565–576.
Lobier M, Siebenhühner F, Palva S, Palva JM. 2014. Phase transfer entropy: a novel phase-based measure for directed connectivity in networks coupled by oscillatory interactions. Neuroimage. 85:853–872.
López ME, Pusil S, Pereda E, Maestú F, Barceló F. 2019. Dynamic low frequency EEG phase

synchronization patterns during proactive control of task switching. Neuroimage. 186:70–82.
Marwan N, Romano MC, Thiel M, Kurths J. 2007. Recurrence plots for the analysis of complex systems. Phys Rep. 438:237–329.
Mayville JM, Fuchs A, Kelso JAS. 2005. Neuromagnetic motor fields accompanying self-paced rhythmic finger movement at different rates. Exp brain Res. 166:190–199.
Nolte G. 2003. The magnetic lead field theorem in the quasi-static approximation and its use for magnetoencephalography forward calculation in realistic volume conductors. Phys Med Biol. 48:3637.
Nunez PL, Srinivasan R, Westdorp AF, Wijesinghe RS, Tucker DM, Silberstein RB, Cadusch PJ. 1997. EEG coherency: I: statistics, reference electrode, volume conduction, Laplacians, cortical imaging, and interpretation at multiple scales. Electroencephalogr Clin Neurophysiol. 103:499– 515.
O’neill GC, Bauer M, Woolrich MW, Morris PG, Barnes GR, Brookes MJ. 2015. Dynamic recruitment of resting state sub-networks. Neuroimage. 115:85–95.
O’Neill GC, Tewarie P, Vidaurre D, Liuzzi L, Woolrich MW, Brookes MJ. 2017. Dynamics of large-scale electrophysiological networks: A technical review. Neuroimage.
O’Neill GC, Tewarie PK, Colclough GL, Gascoyne LE, Hunt BAE, Morris PG, Woolrich MW, Brookes MJ. 2017. Measurement of dynamic task related functional networks using MEG. Neuroimage. 146:667–678.
Ponce-Alvarez A, Deco G, Hagmann P, Romani GL, Mantini D, Corbetta M. 2015. Resting-state temporal synchronization networks emerge from connectivity topology and heterogeneity. PLoS Comput Biol. 11:e1004100.
Preti MG, Bolton TAW, Van De Ville D. 2017. The dynamic functional connectome: State-of-the-art and perspectives. Neuroimage. 160:41–54.
Quinn AJ, Vidaurre D, Abeysuriya R, Becker R, Nobre AC, Woolrich MW. 2018. Task-Evoked Dynamic Network Analysis Through Hidden Markov Modeling. Front Neurosci. 12.
Robinson SE. 1999. Functional neuroimaging by synthetic aperture magnetometry (SAM). Recent Adv Biomagn. 302–305.
Sarvas J. 1987. Basic mathematical and electromagnetic concepts of the biomagnetic inverse problem. Phys Med Biol. 32:11.
Sekihara K, Nagarajan SS. 2008. Adaptive spatial filters for electromagnetic brain imaging. Springer Science & Business Media.
Sitnikova TA, Hughes JW, Ahlfors SP, Woolrich MW, Salat DH. 2018. Short timescale abnormalities in the states of spontaneous synchrony in the functional neural networks in Alzheimer’s disease. NeuroImage Clin.
Smith SM, Jenkinson M, Woolrich MW, Beckmann CF, Behrens TEJ, Johansen-Berg H, Bannister PR, De Luca M, Drobnjak I, Flitney DE. 2004. Advances in functional and structural MR image analysis and implementation as FSL. Neuroimage. 23:S208–S219.
Stam CJ, De Bruin EA. 2004. Scale‐free dynamics of global functional connectivity in the human brain. Hum Brain Mapp. 22:97–109.
Stam CJ, Montez T, Jones BF, Rombouts S, Van Der Made Y, Pijnenburg YAL, Scheltens P. 2005.

Disturbed fluctuations of resting state EEG synchronization in Alzheimer’s disease. Clin Neurophysiol. 116:708–715.
Stam CJ, Nolte G, Daffertshofer A. 2007. Phase lag index: assessment of functional connectivity from multi channel EEG and MEG with diminished bias from common sources. Hum Brain Mapp. 28:1178–1193.
Stam CJ, Van Dijk BW. 2002. Synchronization likelihood: an unbiased measure of generalized synchronization in multivariate data sets. Phys D Nonlinear Phenom. 163:236–251.
Suzuki M, Wasaka T, Inui K, Kakigi R. 2013. Reappraisal of field dynamics of motor cortex during self‐ paced finger movements. Brain Behav. 3:747–762.
Tewarie P, Abeysuriya RG, Byrne Á, O’Neill GC, Sotiropoulos SN, Brookes MJ, Coombes S. 2019. How do spatially distinct frequency specific MEG networks emerge from one underlying structural connectome? The role of the structural eigenmodes. Neuroimage.
Tewarie P, Hunt BAE, O’Neill GC, Byrne A, Aquino K, Bauer M, Mullinger KJ, Coombes S, Brookes MJ. 2018. Relationships between neuronal oscillatory amplitude and dynamic functional connectivity. Cereb Cortex.
Timmerman ME, Kiers HAL. 2000. Three‐mode principal components analysis: Choosing the numbers of components and sensitivity to local optima. Br J Math Stat Psychol. 53:1–16.
Torrence C, Compo GP. 1998. A practical guide to wavelet analysis. Bull Am Meteorol Soc. 79:61–78.
Tzourio-Mazoyer N, Landeau B, Papathanassiou D, Crivello F, Etard O, Delcroix N, Mazoyer B, Joliot M. 2002. Automated anatomical labeling of activations in SPM using a macroscopic anatomical parcellation of the MNI MRI single-subject brain. Neuroimage. 15:273–289.
Van de Ville D, Britz J, Michel CM. 2010. EEG microstate sequences in healthy humans at rest reveal scale-free dynamics. Proc Natl Acad Sci. 201007841.
Van Essen DC, Smith SM, Barch DM, Behrens TEJ, Yacoub E, Ugurbil K, Consortium W-MHCP. 2013. The WU-Minn human connectome project: an overview. Neuroimage. 80:62–79.
Varela F, Lachaux J-P, Rodriguez E, Martinerie J. 2001. The brainweb: phase synchronization and large-scale integration. Nat Rev Neurosci. 2:229.
Vidaurre D, Hunt LT, Quinn AJ, Hunt BAE, Brookes MJ, Nobre AC, Woolrich MW. 2018. Spontaneous cortical activity transiently organises into frequency specific phase-coupling networks. Nat Commun. 9:2987.
Vidaurre D, Quinn AJ, Baker AP, Dupret D, Tejero-Cantero A, Woolrich MW. 2016. Spectrally resolved fast transient brain states in electrophysiological data. Neuroimage. 126:81–95.
Vidaurre D, Smith SM, Woolrich MW. 2017. Brain network dynamics are hierarchically organized in time. Proc Natl Acad Sci. 114:12827–12832.
Watanabe T, Rees G. 2017. Brain network dynamics in high-functioning individuals with autism. Nat Commun. 8:16048.

